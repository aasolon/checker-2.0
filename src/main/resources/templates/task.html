<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <title>task</title>
  <link th:href="@{/css/checker.css}" rel="stylesheet"/>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script th:inline="javascript">
    function submitResult() {
      var submitData = {taskId: $("#taskId").val(), langId: $("#langId").val(), token: $("#token").val(),
        sourceCode: $("#sourceCode").val()};

      $.ajax({
        type:"POST",
        contentType: "application/json",
        url: /*[[@{/submit-result}]]*/ null,
        data: JSON.stringify(submitData),
        dataType: 'html',
        success: function(responseText) {
          $("#errorBlock").empty();
          var html = $.parseHTML(responseText)[0];
          if (html["id"] == "resultlist") {
            $("#sourceCode").val("");
            $("#resultBlock").html(responseText);
          }
          if (html["id"] == "errorlist")
            $("#errorBlock").html(responseText);
        },
        error: function() {
          $("#errorBlock").html(
              '<h4>Что-то пошло не так:</h4>' +
              '<table class="woBorder">' +
              ' <tr>' +
              '   <td class="woBorder">Ошибка при получении ответа от сервера, обратиесть к администратору</td>' +
              ' </tr>' +
              '</table>'
          );
        }
      });
    }

    function refreshResultList() {
      var refreshData = {taskId: $("#taskId").val(), token: $("#token").val()};

      $.ajax({
        type:"POST",
        contentType: "application/json",
        url: /*[[@{/refreshResultList}]]*/ null,
        data: JSON.stringify(refreshData),
        dataType: 'html',
        success: function(responseText) {
          $("#errorBlock").empty();
          var html = $.parseHTML(responseText)[0];
          if (html["id"] == "resultlist") {
            $("#resultBlock").html(responseText);
          }
          if (html["id"] == "errorlist")
            $("#errorBlock").html(responseText);
        },
        error: function() {
          $("#errorBlock").html(
              '<h4>Что-то пошло не так:</h4>' +
              '<table class="woBorder">' +
              ' <tr>' +
              '   <td class="woBorder">Ошибка при получении ответа от сервера, обратиесть к администратору</td>' +
              ' </tr>' +
              '</table>'
          );
        }
      });
    }
  </script>
</head>
<body>
  <div id="container">
    <input id="taskId" type="hidden" th:value="${task.id}"/>
    <h2 th:text="${task.name}">Задание 1</h2>
    <p th:utext="${task.description}">Описание задания</p>
    <h4>Исходные данные</h4>
    <p th:utext="${task.initialData}">Описание исходных данных</p>
    <h4>Результат</h4>
    <p th:utext="${task.result}">Описание результата</p>
    <h4>Пример</h4>
    <table>
      <thead>
        <tr>
          <th>Исходные данные</th>
          <th>Результат</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td th:utext="${task.exampleInitialData}">0</td>
          <td th:utext="${task.exampleResult}">1</td>
        </tr>
      </tbody>
    </table>



    <p>Token:</p>
    <input id="token" type="text" size="50" width="100%"/>
    <p>Язык:</p>
    <select id="langId">
      <option th:each="lang : ${langList}"
              th:value="${lang.id}"
              th:text="${lang.name}"></option>
    </select>
    <p>Исходный код решения (не более 64 КБ):</p>
    <textarea id="sourceCode" rows="10" cols="100"></textarea>
    <br/>
    <br/>
    <input type="submit" value="Отправить" onclick="submitResult()"/>
    <input type="submit" value="Обновить результаты" onclick="refreshResultList()"/>

    <div id="errorBlock" style="color:red">
    </div>

    <div id="resultBlock">
    </div>
  </div>
</body>
</html>